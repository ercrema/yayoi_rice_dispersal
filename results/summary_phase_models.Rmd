---
title: "Regional Phase Model Summary"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
#Setup Libraries and Load Data
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(corrplot)
library(here)
library(rcarbon)
library(coda)
library(ggplot2)
library(ggridges)
## Load Results
load(here('results','unif_model0.RData'))
load(here('results','unif_model1.RData'))
load(here('results','unif_model2.RData'))
load(here('results','trap_model0.RData'))
load(here('results','trap_model1.RData'))
load(here('results','trap_model2.RData'))
```

# Uniform Phase Models

## Model 0 Results

### MCMC Diagnostics

```{r,echo=FALSE}
theta.index = grep('theta',row.names(rhat.unif.model0$psrf))
rhat.stat1 = sum(rhat.unif.model0$psrf[,1]>1.01)
rhat.stat2 = sum(rhat.unif.model0$psrf[theta.index,1]>1.01)
min.ess = min(ess.unif.model0)
min.ess2 = min(ess.unif.model0[-theta.index])
```
* Number of parameters with Rhat below 1.01:`r rhat.stat1`
* Of which $\theta$ parameters were :`r rhat.stat2`
* Smallest Effective Samples Size: `r min.ess`
* Smallest Effective Sample Size without $\theta$ parameters: `r min.ess2`


```{r,echo=FALSE}
par(mfrow=c(2,2))
theta.index = grep('theta',row.names(rhat.unif.model0$psrf))
hist(rhat.unif.model0$psrf[,1],xlab='Rhat',main='All Parameters')
abline(v=1.01,lty=2)
hist(rhat.unif.model0$psrf[-theta.index,1],xlab='Rhat',main='Excluding Theta')
abline(v=1.01,lty=2)
hist(ess.unif.model0,xlab='ESS',main='All Parameters')
hist(ess.unif.model0[-theta.index],xlab='ESS',main='Excluding Theta')
```



### Agreement Index
* Overall agreement Index: `r round(a.unif.model0$overall.agreement,2)`
* Percentage individual agreement index < 60%: `r round((sum(a.unif.model0$agreement < 60))/length(a.unif.model0$agreement) * 100,2)`

```{r,echo=FALSE}
hist(a.unif.model0$agreement,xlab='Agreement Index',main='Agreement Index Uniform Model 0')
```

### Posterior Estimates

Marginal posterior distribution of start dates:

```{r,echo=FALSE,fig.height=10,message=FALSE}
start.index = grep('^a\\[',colnames(out.unif.model0[[1]]))
comb.out = do.call(rbind,out.unif.model0)[,start.index]
area =  rep(paste('Area',as.roman(1:8)),each=nrow(comb.out))
comb.long = data.frame(Posterior=as.numeric(comb.out),Area=area)

main.col <- c(rgb(51,34,136,maxColorValue=255),rgb(136,204,238,maxColorValue = 255),rgb(68,170,153,maxColorValue = 255),rgb(17,119,51,maxColorValue = 255),rgb(153,153,51,maxColorValue = 255),rgb(221,204,119,maxColorValue = 255),rgb(204,102,119,maxColorValue = 255),rgb(136,34,85,maxColorValue = 255))



ggplot(comb.long, aes(x = Posterior, y = area,fill=area)) + 
	geom_density_ridges()+
	scale_fill_manual(values=main.col) + 
	scale_x_reverse(breaks=BCADtoBP(c(-1200,-1000,-800,-600,-400,-200,1,200)),labels=c('1200BC','1000BC','800BC','600BC','400BC','200BC','1AD','200AD'),limits=c(3300,1700)) +
	theme(legend.position = "none")
```

Marginal posterior summary statistics:

```{r,echo=FALSE}
hpdi95 = coda::HPDinterval(mcmc(comb.out))
hpdi50 = coda::HPDinterval(mcmc(comb.out),prob = 0.5)
med = round(BPtoBCAD(apply(comb.out,2,median)))
Areas = paste('Area',as.roman(1:8))
post.d = data.frame(Area=Areas,HPDI95lo=round(BPtoBCAD(hpdi95[,2])),HPDI50lo=round(BPtoBCAD(hpdi50[,2])),Median=med,HPDI50hi=round(BPtoBCAD(hpdi50[,1])),HPDI95hi=round(BPtoBCAD(hpdi95[,1])))

conv  <- function(x)
{
	x = as.character(x)
	x = gsub("-", "BC ", x)
        i = which(!grepl('BC',x))
	if (length(i)>0)
	{
		x[i] = paste('AD',x[i])
	}
	return(x)
}

post.d[,2] = conv(post.d[,2])
post.d[,3] = conv(post.d[,3])
post.d[,4] = conv(post.d[,4])
post.d[,5] = conv(post.d[,5])
post.d[,6] = conv(post.d[,6])

knitr::kable(post.d,col.names = c('Area','95%(lo)','50%(lo)','Median','50%(hi)','95%(hi)'))
```

Probability temporal order (probability row being earlier than column):

```{r,echo=FALSE,message=FALSE}
order.prob  <- matrix(NA,nrow=8,ncol=8,dimnames = list(Areas,Areas))

for (i in 1:8){
	for (j in 1:8){
		if (i!=j)
		{
			order.prob[i,j] = round(sum(comb.out[,i]>comb.out[,j])/nrow(comb.out),2)
		}
	}
}
corrplot(order.prob,is.corr=FALSE,diag=FALSE,col=COL2('RdBu'),addCoef.col = 'white',method='color')
```


## Model 1 Results

### MCMC Diagnostics

```{r,echo=FALSE}
theta.index = grep('theta',row.names(rhat.unif.model1$psrf))
rhat.stat1 = sum(rhat.unif.model1$psrf[,1]>1.01)
rhat.stat2 = sum(rhat.unif.model1$psrf[theta.index,1]>1.01)
min.ess = min(ess.unif.model1)
min.ess2 = min(ess.unif.model1[-theta.index])
```
* Number of parameters with Rhat below 1.01:`r rhat.stat1`
* Of which $\theta$ parameters were :`r rhat.stat2`
* Smallest Effective Samples Size: `r min.ess`
* Smallest Effective Sample Size without $\theta$ parameters: `r min.ess2`


```{r,echo=FALSE}
par(mfrow=c(2,2))
theta.index = grep('theta',row.names(rhat.unif.model1$psrf))
hist(rhat.unif.model1$psrf[,1],xlab='Rhat',main='All Parameters')
abline(v=1.01,lty=2)
hist(rhat.unif.model1$psrf[-theta.index,1],xlab='Rhat',main='Excluding Theta')
abline(v=1.01,lty=2)
hist(ess.unif.model1,xlab='ESS',main='All Parameters')
hist(ess.unif.model1[-theta.index],xlab='ESS',main='Excluding Theta')
```



### Agreement Index
* Overall agreement Index: `r round(a.unif.model1$overall.agreement,2)`
* Percentage individual agreement index < 60%: `r round((sum(a.unif.model1$agreement < 60))/length(a.unif.model1$agreement) * 100,2)`

```{r,echo=FALSE}
hist(a.unif.model1$agreement,xlab='Agreement Index',main='Agreement Index Uniform Model 0')
```

### Posterior Estimates

Marginal posterior distribution of start dates:

```{r,echo=FALSE,fig.height=10,message=FALSE}
start.index = grep('^a\\[',colnames(out.unif.model1[[1]]))
comb.out = do.call(rbind,out.unif.model1)[,start.index]
area =  rep(paste('Area',as.roman(1:8)),each=nrow(comb.out))
comb.long = data.frame(Posterior=as.numeric(comb.out),Area=area)

main.col <- c(rgb(51,34,136,maxColorValue=255),rgb(136,204,238,maxColorValue = 255),rgb(68,170,153,maxColorValue = 255),rgb(17,119,51,maxColorValue = 255),rgb(153,153,51,maxColorValue = 255),rgb(221,204,119,maxColorValue = 255),rgb(204,102,119,maxColorValue = 255),rgb(136,34,85,maxColorValue = 255))



ggplot(comb.long, aes(x = Posterior, y = area,fill=area)) + 
	geom_density_ridges()+
	scale_fill_manual(values=main.col) + 
	scale_x_reverse(breaks=BCADtoBP(c(-1200,-1000,-800,-600,-400,-200,1,200)),labels=c('1200BC','1000BC','800BC','600BC','400BC','200BC','1AD','200AD'),limits=c(3300,1700)) +
	theme(legend.position = "none")
```

Marginal posterior summary statistics:

```{r,echo=FALSE}
hpdi95 = coda::HPDinterval(mcmc(comb.out))
hpdi50 = coda::HPDinterval(mcmc(comb.out),prob = 0.5)
med = round(BPtoBCAD(apply(comb.out,2,median)))
Areas = paste('Area',as.roman(1:8))
post.d = data.frame(Area=Areas,HPDI95lo=round(BPtoBCAD(hpdi95[,2])),HPDI50lo=round(BPtoBCAD(hpdi50[,2])),Median=med,HPDI50hi=round(BPtoBCAD(hpdi50[,1])),HPDI95hi=round(BPtoBCAD(hpdi95[,1])))

conv  <- function(x)
{
	x = as.character(x)
	x = gsub("-", "BC ", x)
        i = which(!grepl('BC',x))
	if (length(i)>0)
	{
		x[i] = paste('AD',x[i])
	}
	return(x)
}

post.d[,2] = conv(post.d[,2])
post.d[,3] = conv(post.d[,3])
post.d[,4] = conv(post.d[,4])
post.d[,5] = conv(post.d[,5])
post.d[,6] = conv(post.d[,6])

knitr::kable(post.d,col.names = c('Area','95%(lo)','50%(lo)','Median','50%(hi)','95%(hi)'))
```

Probability temporal order (probability row being earlier than column):

```{r,echo=FALSE,message=FALSE}
order.prob  <- matrix(NA,nrow=8,ncol=8,dimnames = list(Areas,Areas))

for (i in 1:8){
	for (j in 1:8){
		if (i!=j)
		{
			order.prob[i,j] = round(sum(comb.out[,i]>comb.out[,j])/nrow(comb.out),2)
		}
	}
}
corrplot(order.prob,is.corr=FALSE,diag=FALSE,col=COL2('RdBu'),addCoef.col = 'white',method='color')
```


## Model 2 Results

### MCMC Diagnostics

```{r,echo=FALSE}
theta.index = grep('theta',row.names(rhat.unif.model2$psrf))
rhat.stat1 = sum(rhat.unif.model2$psrf[,1]>1.01)
rhat.stat2 = sum(rhat.unif.model2$psrf[theta.index,1]>1.01)
min.ess = min(ess.unif.model2)
min.ess2 = min(ess.unif.model2[-theta.index])
```
* Number of parameters with Rhat below 1.01:`r rhat.stat1`
* Of which $\theta$ parameters were :`r rhat.stat2`
* Smallest Effective Samples Size: `r min.ess`
* Smallest Effective Sample Size without $\theta$ parameters: `r min.ess2`


```{r,echo=FALSE}
par(mfrow=c(2,2))
theta.index = grep('theta',row.names(rhat.unif.model2$psrf))
hist(rhat.unif.model2$psrf[,1],xlab='Rhat',main='All Parameters')
abline(v=1.01,lty=2)
hist(rhat.unif.model2$psrf[-theta.index,1],xlab='Rhat',main='Excluding Theta')
abline(v=1.01,lty=2)
hist(ess.unif.model2,xlab='ESS',main='All Parameters')
hist(ess.unif.model2[-theta.index],xlab='ESS',main='Excluding Theta')
```



### Agreement Index
* Overall agreement Index: `r round(a.unif.model2$overall.agreement,2)`
* Percentage individual agreement index < 60%: `r round((sum(a.unif.model2$agreement < 60))/length(a.unif.model2$agreement) * 100,2)`

```{r,echo=FALSE}
hist(a.unif.model2$agreement,xlab='Agreement Index',main='Agreement Index Uniform Model 0')
```

### Posterior Estimates

Marginal posterior distribution of start dates:

```{r,echo=FALSE,fig.height=10,message=FALSE}
start.index = grep('^a\\[',colnames(out.unif.model2[[1]]))
comb.out = do.call(rbind,out.unif.model2)[,start.index]
area =  rep(paste('Area',as.roman(1:8)),each=nrow(comb.out))
comb.long = data.frame(Posterior=as.numeric(comb.out),Area=area)

main.col <- c(rgb(51,34,136,maxColorValue=255),rgb(136,204,238,maxColorValue = 255),rgb(68,170,153,maxColorValue = 255),rgb(17,119,51,maxColorValue = 255),rgb(153,153,51,maxColorValue = 255),rgb(221,204,119,maxColorValue = 255),rgb(204,102,119,maxColorValue = 255),rgb(136,34,85,maxColorValue = 255))



ggplot(comb.long, aes(x = Posterior, y = area,fill=area)) + 
	geom_density_ridges()+
	scale_fill_manual(values=main.col) + 
	scale_x_reverse(breaks=BCADtoBP(c(-1200,-1000,-800,-600,-400,-200,1,200)),labels=c('1200BC','1000BC','800BC','600BC','400BC','200BC','1AD','200AD'),limits=c(3300,1700)) +
	theme(legend.position = "none")
```

Marginal posterior summary statistics:

```{r,echo=FALSE}
hpdi95 = coda::HPDinterval(mcmc(comb.out))
hpdi50 = coda::HPDinterval(mcmc(comb.out),prob = 0.5)
med = round(BPtoBCAD(apply(comb.out,2,median)))
Areas = paste('Area',as.roman(1:8))
post.d = data.frame(Area=Areas,HPDI95lo=round(BPtoBCAD(hpdi95[,2])),HPDI50lo=round(BPtoBCAD(hpdi50[,2])),Median=med,HPDI50hi=round(BPtoBCAD(hpdi50[,1])),HPDI95hi=round(BPtoBCAD(hpdi95[,1])))

conv  <- function(x)
{
	x = as.character(x)
	x = gsub("-", "BC ", x)
        i = which(!grepl('BC',x))
	if (length(i)>0)
	{
		x[i] = paste('AD',x[i])
	}
	return(x)
}

post.d[,2] = conv(post.d[,2])
post.d[,3] = conv(post.d[,3])
post.d[,4] = conv(post.d[,4])
post.d[,5] = conv(post.d[,5])
post.d[,6] = conv(post.d[,6])

knitr::kable(post.d,col.names = c('Area','95%(lo)','50%(lo)','Median','50%(hi)','95%(hi)'))
```

Probability temporal order (probability row being earlier than column):

```{r,echo=FALSE,message=FALSE}
order.prob  <- matrix(NA,nrow=8,ncol=8,dimnames = list(Areas,Areas))

for (i in 1:8){
	for (j in 1:8){
		if (i!=j)
		{
			order.prob[i,j] = round(sum(comb.out[,i]>comb.out[,j])/nrow(comb.out),2)
		}
	}
}
corrplot(order.prob,is.corr=FALSE,diag=FALSE,col=COL2('RdBu'),addCoef.col = 'white',method='color')
```

# Trapezium Models

## Model 0 Results

### MCMC Diagnostics

```{r,echo=FALSE}
theta.index = grep('theta',row.names(rhat.trap.model0$psrf))
rhat.stat1 = sum(rhat.trap.model0$psrf[,1]>1.01)
rhat.stat2 = sum(rhat.trap.model0$psrf[theta.index,1]>1.01)
min.ess = min(ess.trap.model0)
min.ess2 = min(ess.trap.model0[-theta.index])
```
* Number of parameters with Rhat below 1.01:`r rhat.stat1`
* Of which $\theta$ parameters were :`r rhat.stat2`
* Smallest Effective Samples Size: `r min.ess`
* Smallest Effective Sample Size without $\theta$ parameters: `r min.ess2`


```{r,echo=FALSE}
par(mfrow=c(2,2))
theta.index = grep('theta',row.names(rhat.trap.model0$psrf))
hist(rhat.trap.model0$psrf[,1],xlab='Rhat',main='All Parameters')
abline(v=1.01,lty=2)
hist(rhat.trap.model0$psrf[-theta.index,1],xlab='Rhat',main='Excluding Theta')
abline(v=1.01,lty=2)
hist(ess.trap.model0,xlab='ESS',main='All Parameters')
hist(ess.trap.model0[-theta.index],xlab='ESS',main='Excluding Theta')
```



### Agreement Index
* Overall agreement Index: `r round(a.trap.model0$overall.agreement,2)`
* Percentage individual agreement index < 60%: `r round((sum(a.trap.model0$agreement < 60))/length(a.trap.model0$agreement) * 100,2)`

```{r,echo=FALSE}
hist(a.trap.model0$agreement,xlab='Agreement Index',main='Agreement Index Uniform Model 0')
```

### Posterior Estimates

Marginal posterior distribution of start dates:

```{r,echo=FALSE,fig.height=10,message=FALSE}
start.index = grep('^a\\[',colnames(out.trap.model0[[1]]))
comb.out = do.call(rbind,out.trap.model0)[,start.index]
area =  rep(paste('Area',as.roman(1:8)),each=nrow(comb.out))
comb.long = data.frame(Posterior=as.numeric(comb.out),Area=area)

main.col <- c(rgb(51,34,136,maxColorValue=255),rgb(136,204,238,maxColorValue = 255),rgb(68,170,153,maxColorValue = 255),rgb(17,119,51,maxColorValue = 255),rgb(153,153,51,maxColorValue = 255),rgb(221,204,119,maxColorValue = 255),rgb(204,102,119,maxColorValue = 255),rgb(136,34,85,maxColorValue = 255))



ggplot(comb.long, aes(x = Posterior, y = area,fill=area)) + 
	geom_density_ridges()+
	scale_fill_manual(values=main.col) + 
	scale_x_reverse(breaks=BCADtoBP(c(-1200,-1000,-800,-600,-400,-200,1,200)),labels=c('1200BC','1000BC','800BC','600BC','400BC','200BC','1AD','200AD'),limits=c(3300,1700)) +
	theme(legend.position = "none")
```

Marginal posterior summary statistics:

```{r,echo=FALSE}
hpdi95 = coda::HPDinterval(mcmc(comb.out))
hpdi50 = coda::HPDinterval(mcmc(comb.out),prob = 0.5)
med = round(BPtoBCAD(apply(comb.out,2,median)))
Areas = paste('Area',as.roman(1:8))
post.d = data.frame(Area=Areas,HPDI95lo=round(BPtoBCAD(hpdi95[,2])),HPDI50lo=round(BPtoBCAD(hpdi50[,2])),Median=med,HPDI50hi=round(BPtoBCAD(hpdi50[,1])),HPDI95hi=round(BPtoBCAD(hpdi95[,1])))

conv  <- function(x)
{
	x = as.character(x)
	x = gsub("-", "BC ", x)
        i = which(!grepl('BC',x))
	if (length(i)>0)
	{
		x[i] = paste('AD',x[i])
	}
	return(x)
}

post.d[,2] = conv(post.d[,2])
post.d[,3] = conv(post.d[,3])
post.d[,4] = conv(post.d[,4])
post.d[,5] = conv(post.d[,5])
post.d[,6] = conv(post.d[,6])

knitr::kable(post.d,col.names = c('Area','95%(lo)','50%(lo)','Median','50%(hi)','95%(hi)'))
```

Probability temporal order (probability row being earlier than column):

```{r,echo=FALSE,message=FALSE}
order.prob  <- matrix(NA,nrow=8,ncol=8,dimnames = list(Areas,Areas))

for (i in 1:8){
	for (j in 1:8){
		if (i!=j)
		{
			order.prob[i,j] = round(sum(comb.out[,i]>comb.out[,j])/nrow(comb.out),2)
		}
	}
}
corrplot(order.prob,is.corr=FALSE,diag=FALSE,col=COL2('RdBu'),addCoef.col = 'white',method='color')
```


## Model 1 Results

### MCMC Diagnostics

```{r,echo=FALSE}
theta.index = grep('theta',row.names(rhat.trap.model1$psrf))
rhat.stat1 = sum(rhat.trap.model1$psrf[,1]>1.01)
rhat.stat2 = sum(rhat.trap.model1$psrf[theta.index,1]>1.01)
min.ess = min(ess.trap.model1)
min.ess2 = min(ess.trap.model1[-theta.index])
```
* Number of parameters with Rhat below 1.01:`r rhat.stat1`
* Of which $\theta$ parameters were :`r rhat.stat2`
* Smallest Effective Samples Size: `r min.ess`
* Smallest Effective Sample Size without $\theta$ parameters: `r min.ess2`


```{r,echo=FALSE}
par(mfrow=c(2,2))
theta.index = grep('theta',row.names(rhat.trap.model1$psrf))
hist(rhat.trap.model1$psrf[,1],xlab='Rhat',main='All Parameters')
abline(v=1.01,lty=2)
hist(rhat.trap.model1$psrf[-theta.index,1],xlab='Rhat',main='Excluding Theta')
abline(v=1.01,lty=2)
hist(ess.trap.model1,xlab='ESS',main='All Parameters')
hist(ess.trap.model1[-theta.index],xlab='ESS',main='Excluding Theta')
```



### Agreement Index
* Overall agreement Index: `r round(a.trap.model1$overall.agreement,2)`
* Percentage individual agreement index < 60%: `r round((sum(a.trap.model1$agreement < 60))/length(a.trap.model1$agreement) * 100,2)`

```{r,echo=FALSE}
hist(a.trap.model1$agreement,xlab='Agreement Index',main='Agreement Index Uniform Model 0')
```

### Posterior Estimates

Marginal posterior distribution of start dates:

```{r,echo=FALSE,fig.height=10,message=FALSE}
start.index = grep('^a\\[',colnames(out.trap.model1[[1]]))
comb.out = do.call(rbind,out.trap.model1)[,start.index]
area =  rep(paste('Area',as.roman(1:8)),each=nrow(comb.out))
comb.long = data.frame(Posterior=as.numeric(comb.out),Area=area)

main.col <- c(rgb(51,34,136,maxColorValue=255),rgb(136,204,238,maxColorValue = 255),rgb(68,170,153,maxColorValue = 255),rgb(17,119,51,maxColorValue = 255),rgb(153,153,51,maxColorValue = 255),rgb(221,204,119,maxColorValue = 255),rgb(204,102,119,maxColorValue = 255),rgb(136,34,85,maxColorValue = 255))



ggplot(comb.long, aes(x = Posterior, y = area,fill=area)) + 
	geom_density_ridges()+
	scale_fill_manual(values=main.col) + 
	scale_x_reverse(breaks=BCADtoBP(c(-1200,-1000,-800,-600,-400,-200,1,200)),labels=c('1200BC','1000BC','800BC','600BC','400BC','200BC','1AD','200AD'),limits=c(3300,1700)) +
	theme(legend.position = "none")
```

Marginal posterior summary statistics:

```{r,echo=FALSE}
hpdi95 = coda::HPDinterval(mcmc(comb.out))
hpdi50 = coda::HPDinterval(mcmc(comb.out),prob = 0.5)
med = round(BPtoBCAD(apply(comb.out,2,median)))
Areas = paste('Area',as.roman(1:8))
post.d = data.frame(Area=Areas,HPDI95lo=round(BPtoBCAD(hpdi95[,2])),HPDI50lo=round(BPtoBCAD(hpdi50[,2])),Median=med,HPDI50hi=round(BPtoBCAD(hpdi50[,1])),HPDI95hi=round(BPtoBCAD(hpdi95[,1])))

conv  <- function(x)
{
	x = as.character(x)
	x = gsub("-", "BC ", x)
        i = which(!grepl('BC',x))
	if (length(i)>0)
	{
		x[i] = paste('AD',x[i])
	}
	return(x)
}

post.d[,2] = conv(post.d[,2])
post.d[,3] = conv(post.d[,3])
post.d[,4] = conv(post.d[,4])
post.d[,5] = conv(post.d[,5])
post.d[,6] = conv(post.d[,6])

knitr::kable(post.d,col.names = c('Area','95%(lo)','50%(lo)','Median','50%(hi)','95%(hi)'))
```

Probability temporal order (probability row being earlier than column):

```{r,echo=FALSE,message=FALSE}
order.prob  <- matrix(NA,nrow=8,ncol=8,dimnames = list(Areas,Areas))

for (i in 1:8){
	for (j in 1:8){
		if (i!=j)
		{
			order.prob[i,j] = round(sum(comb.out[,i]>comb.out[,j])/nrow(comb.out),2)
		}
	}
}
corrplot(order.prob,is.corr=FALSE,diag=FALSE,col=COL2('RdBu'),addCoef.col = 'white',method='color')
```


## Model 2 Results

### MCMC Diagnostics

```{r,echo=FALSE}
theta.index = grep('theta',row.names(rhat.trap.model2$psrf))
rhat.stat1 = sum(rhat.trap.model2$psrf[,1]>1.01)
rhat.stat2 = sum(rhat.trap.model2$psrf[theta.index,1]>1.01)
min.ess = min(ess.trap.model2)
min.ess2 = min(ess.trap.model2[-theta.index])
```
* Number of parameters with Rhat below 1.01:`r rhat.stat1`
* Of which $\theta$ parameters were :`r rhat.stat2`
* Smallest Effective Samples Size: `r min.ess`
* Smallest Effective Sample Size without $\theta$ parameters: `r min.ess2`


```{r,echo=FALSE}
par(mfrow=c(2,2))
theta.index = grep('theta',row.names(rhat.trap.model2$psrf))
hist(rhat.trap.model2$psrf[,1],xlab='Rhat',main='All Parameters')
abline(v=1.01,lty=2)
hist(rhat.trap.model2$psrf[-theta.index,1],xlab='Rhat',main='Excluding Theta')
abline(v=1.01,lty=2)
hist(ess.trap.model2,xlab='ESS',main='All Parameters')
hist(ess.trap.model2[-theta.index],xlab='ESS',main='Excluding Theta')
```



### Agreement Index
* Overall agreement Index: `r round(a.trap.model2$overall.agreement,2)`
* Percentage individual agreement index < 60%: `r round((sum(a.trap.model2$agreement < 60))/length(a.trap.model2$agreement) * 100,2)`

```{r,echo=FALSE}
hist(a.trap.model2$agreement,xlab='Agreement Index',main='Agreement Index Uniform Model 0')
```

### Posterior Estimates

Marginal posterior distribution of start dates:

```{r,echo=FALSE,fig.height=10,message=FALSE}
start.index = grep('^a\\[',colnames(out.trap.model2[[1]]))
comb.out = do.call(rbind,out.trap.model2)[,start.index]
area =  rep(paste('Area',as.roman(1:8)),each=nrow(comb.out))
comb.long = data.frame(Posterior=as.numeric(comb.out),Area=area)

main.col <- c(rgb(51,34,136,maxColorValue=255),rgb(136,204,238,maxColorValue = 255),rgb(68,170,153,maxColorValue = 255),rgb(17,119,51,maxColorValue = 255),rgb(153,153,51,maxColorValue = 255),rgb(221,204,119,maxColorValue = 255),rgb(204,102,119,maxColorValue = 255),rgb(136,34,85,maxColorValue = 255))



ggplot(comb.long, aes(x = Posterior, y = area,fill=area)) + 
	geom_density_ridges()+
	scale_fill_manual(values=main.col) + 
	scale_x_reverse(breaks=BCADtoBP(c(-1200,-1000,-800,-600,-400,-200,1,200)),labels=c('1200BC','1000BC','800BC','600BC','400BC','200BC','1AD','200AD'),limits=c(3300,1700)) +
	theme(legend.position = "none")
```

Marginal posterior summary statistics:

```{r,echo=FALSE}
hpdi95 = coda::HPDinterval(mcmc(comb.out))
hpdi50 = coda::HPDinterval(mcmc(comb.out),prob = 0.5)
med = round(BPtoBCAD(apply(comb.out,2,median)))
Areas = paste('Area',as.roman(1:8))
post.d = data.frame(Area=Areas,HPDI95lo=round(BPtoBCAD(hpdi95[,2])),HPDI50lo=round(BPtoBCAD(hpdi50[,2])),Median=med,HPDI50hi=round(BPtoBCAD(hpdi50[,1])),HPDI95hi=round(BPtoBCAD(hpdi95[,1])))

conv  <- function(x)
{
	x = as.character(x)
	x = gsub("-", "BC ", x)
        i = which(!grepl('BC',x))
	if (length(i)>0)
	{
		x[i] = paste('AD',x[i])
	}
	return(x)
}

post.d[,2] = conv(post.d[,2])
post.d[,3] = conv(post.d[,3])
post.d[,4] = conv(post.d[,4])
post.d[,5] = conv(post.d[,5])
post.d[,6] = conv(post.d[,6])

knitr::kable(post.d,col.names = c('Area','95%(lo)','50%(lo)','Median','50%(hi)','95%(hi)'))
```

Probability temporal order (probability row being earlier than column):

```{r,echo=FALSE,message=FALSE}
order.prob  <- matrix(NA,nrow=8,ncol=8,dimnames = list(Areas,Areas))

for (i in 1:8){
	for (j in 1:8){
		if (i!=j)
		{
			order.prob[i,j] = round(sum(comb.out[,i]>comb.out[,j])/nrow(comb.out),2)
		}
	}
}
corrplot(order.prob,is.corr=FALSE,diag=FALSE,col=COL2('RdBu'),addCoef.col = 'white',method='color')
```
